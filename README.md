# Baccarat (対戦型バカラ)

VB.NET (Windows Forms) で実装された、TCP通信による2人対戦型バカラアプリケーションです。
サーバー権威型（Server Authority）でゲーム進行を管理し、2つのクライアントが接続して対戦します。

> **最新ステータス**: v1.1 実装フェーズ (2026-01-07 更新)

---

## プロジェクト構成

このソリューションは3つのプロジェクトで構成されています。

- **Baccarat.Server**: ゲームサーバー。ゲーム進行 (Phase)、判定、チップ管理を行う権威サーバー。
- **Baccarat.Client**: プレイヤー用クライアント。UI表示、ベット操作、サーバーへの通信を行う。
- **Baccarat.Shared**: 共通ライブラリ。通信プロトコル、データモデル、ルール計算ロジック。

### ディレクトリ構造
```
.
├── Baccarat.sln          # ソリューションファイル
├── Baccarat.Server/      # サーバープロジェクト
├── Baccarat.Client/      # クライアントプロジェクト
├── Baccarat.Shared/      # 共通ライブラリ
├── lib/                  # 外部DLL (Experiment.TcpSocket.dll)
├── docs/                 # 詳細ドキュメント
│   ├── CONTEXT.md        # 要件定義、仕様詳細
│   ├── exprement.md      # Experiment.TcpSocket 仕様書 (堅牢版)
│   └── ...
├── TASKS.md              # タスク一覧と優先度
├── PROGRESS.md           # 進捗レポート
└── README.md             # 本ファイル
```

---

## 開発環境とセットアップ

### 必須環境
- **Visual Studio 2022** (または同等)
- **.NET Framework** (ターゲット: 4.8 推奨)
- **Windows Forms** 開発ワークロード

### ビルド手順
1. `Baccarat.sln` を Visual Studio で開く。
2. ソリューション全体を **リビルド** する。
3. `bin/Debug` フォルダに `Experiment.TcpSocket.dll` がコピーされていることを確認する。

### 実行方法
1. **サーバー**: `Baccarat.Server` をデバッグ実行 (または exe 起動)。待機状態にする。
2. **クライアント**: `Baccarat.Client` を2つ起動。
3. ロビー画面でニックネームを入力し、サーバーへ接続。

---

## 開発ガイドライン (共同開発者向け)

### 1. UI実装のルール
- 原則として **Visual Studio のフォームデザイナー** を使用してください。
- **命名規則**:
  - TextBox: `txt...` (例: `txtLog`, `txtNickname`)
  - Button: `btn...` (例: `btnConnect`, `btnBet`)
  - Label: `lbl...` (例: `lblStatus`, `lblPhase`)
- **ログ出力**: 各フォームの `AppendLog` メソッドを経由して `txtLog` に出力してください。

### 2. TCP通信 (`Experiment.TcpSocket`)
- ツールボックスから `TcpSockets` コンポーネントをフォームに配置します。
- プロパティ **`SynchronizingObject`** にフォーム自身 (`Me` / `FormServer`) を必ず設定してください。
  - これにより、`DataReceive` などのイベントが UIスレッドで安全に実行されます。
- **行フレーミング**: 受信データは `Shared.Protocol.LineFramer` を使用して、改行コード (`\n`) 区切りで行単位に分割してから処理します。
- **仕様書**: `Experiment.TcpSocket` の詳細仕様は [**docs/exprement.md**](./docs/exprement.md) を参照してください。

### 3. ゲーム進行 (Phase)
- ゲーム状態は `Shared.Model.GamePhase` で定義されています (LOBBY, BETTING, DEALING, RESULT)。
- クライアントはサーバーから送られる `PHASE` コマンドに従って画面制御 (`ApplyPhase` メソッド) を行います。勝手に状態を変更しないでください。

### 4. サーバー実装 (ServerHost)
- `Baccarat.Server.Net.ServerHost` は、UI (`FormServer`) から `sendAction` デリゲートを受け取り、通信機能を利用します (DIパターン)。
- サーバーロジックは `ServerHost` に集約し、フォーム側はイベントの橋渡しとログ表示に徹してください。

---

## ドキュメント

- [**TASKS.md**](./TASKS.md): 実装タスク一覧と優先度 (P0/P1)。開発はこれに従って進めます。
- [**PROGRESS.md**](./PROGRESS.md): 日々の進捗レポート。
- [**docs/CONTEXT.md**](./docs/CONTEXT.md): 要件定義、仕様詳細、プロトコル定義。
- [**docs/exprement.md**](./docs/exprement.md): 通信ライブラリ仕様書。

---

## 🤝 チームで開発する皆さんへ（開発の進め方）

このプロジェクトへようこそ！みんなで楽しく、スムーズに開発を進めるためのガイドです。

### 1. まずは「何をするか」を確認しよう
- [**TASKS.md**](./TASKS.md) を開いてみてください。
- ここには、これから作る機能が「優先度（P0〜P2）」順に並んでいます。
- 自分が担当したいタスクを見つけたら、メンバーに伝えて作業を開始しましょう！

### 2. プロジェクトの「中身」をのぞいてみよう
フォルダが3つに分かれていますが、役割はシンプルです。
- **Shared（みんなの宝箱）**: 通信のルールや、カードのデータなど、サーバーとクライアントの両方で使う大切なものが入っています。
- **Server（ゲームの審判）**: ゲームの進行や勝敗を決める「頭脳」です。
- **Client（プレイヤーの窓口）**: 画面（フォーム）を作ったり、ボタンが押された時の動きを作ります。

### 3. 作業のコツとお約束
- **小さな一歩を大切に**: 大きな機能を作る時も、少し作ったら「コミット」して、こまめに保存しましょう。
- **コメントは「未来の自分と仲間」への手紙**: 複雑な処理を書いた時は、「なぜこう書いたのか」を日本語で書き残しておくと、みんなが助かります。
- **UIはデザイナーにおまかせ**: 画面の見た目は Visual Studio の「デザイナー画面」で直感的に作ってOKです。コードで画面を作るのは最小限にしましょう。

### 4. 困ったときは……
- 「ビルドが通らない！」「このエラーどうすればいい？」と思ったら、すぐに周りに相談してください。
- `PROGRESS.md` に今の悩みを書いておくだけでも、誰かが気づいて助けてくれるかもしれません。
- 完璧を目指さず、まずは「動くもの」を一緒に作っていきましょう！

---

## ライセンス / 権利
- 本プロジェクトは教育/演習目的で作成されています。
- 通信ライブラリ: `Experiment.TcpSocket.dll` (学内/プロジェクト配布物)